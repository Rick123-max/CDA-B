# MODULE 10

## SWITCHING

### Introduction to Switching
- Switches operate at Layer 2 of the OSI model
  - **1 Broadcast Domain and collision domains equal to number of open ports**
- These devices are responsible for both the physical connection between devices as well as forwarding data frames received to the next recipient on the same network
- Traversal between networks is handled on Layer 3 of the OSI model
- This lesson uses the terms **frame**, **data frame**, or **ethernet frame** when referring to a discrete piece of data transmitted over Layer 2, and **packet** when referring to Layer 3 or higher equivalents.
- The same piece of data may be described as a frame, packet, or datagram depending on the context.

#### OSI Model
- The OSI Model consists of seven layers, shown in this chart:

<img width="552" height="732" alt="image" src="https://github.com/user-attachments/assets/3799f1e6-8572-486f-823c-7c0c8c80d8b4" />

- Layer 2 of the OSI model — the **Data Link layer** — handles addressing ethernet frames to direct communication between hosts on the same Local Area Network (LAN)
- Ethernet frames include Layer 2 addressing with vendor-assigned unique source and destination addresses for segments.
- In addition, ethernet commonly uses MAC addresses for communication on a segment.
- Other Layer 2 protocols — such as Frame Relay — use a completely different method of Layer 2 addressing.
- **MAC addresses are unique 48-bit addresses, separated into six octets, and noted in hexadecimal format.**
  - The first three octets — known as the Organizationally Unique Identifiers (OUI) — are assigned by the Institute of Electrical and Electronics Engineers (IEEE) to a manufacturer.
  - Each manufacturer is responsible for ensuring that the last three octets are unique for each device built.

#### Layer 2 Devices
- The simplest Layer 2 device for ethernet networks that allows multiple devices to communicate with each other is the **hub**
  - **1 Broadcast Domain and 1 Collision Domain**
- These devices broadcast all received data frames to all ports, regardless of the intended recipient.
- While these simple devices may still be found in some older networks, their usage is discouraged due to issues that they present including:
  - The broadcast behavior allows any connected device to view traffic bound for any other device on the hub.
  - Due to the rebroadcast nature of this device, transmitted frames can often collide when two connected devices attempt to send at the same time — especially during high-traffic load — causing dropped frames or retransmissions.
- Like hubs, switches allow for connectivity between devices; however, unlike hubs, switches utilize logic to determine which ports to forward frames onto
- Basic switches exist that perform only the bare minimum of switching to ensure that collisions do not occur frequently and ensure basic addressing.
  - These switches — sometimes referred to as **unmanaged switches** — can be found in small business and home networks and even see use in enterprise networks
- However, **managed switches** are typically utilized in enterprise networks, especially for central connectivity within the network.
  - These switches are able to be configured and support more features — such as the ability to **mirror ports**, **create VLANs** to segregate networks, etc.

#### Collision Domains
- When ethernet was introduced, it started leveraging technologies such as **Thinnet (10Base-2)** and **Thicknet (10Base-5)** coaxial cables as a transmission medium, in which devices connected to the medium with **Vampire Taps** or **T connectors**
- To mitigate the impact collisions have on a network, ethernet uses **Carrier Sense Multiple Access/Collision Detect (CSMA/CD)** to guarantee that only one host transmits at any given time in a collision domain
- If two hosts transmit at the same time, and the transmitting host senses that another host is also transmitting, it stops transmitting the frame, sends a jam signal, and waits a random time interval before attempting to retransmit the frame
- This means that hosts can either transmit or receive data at one time (operate at half-duplex).
- Network switches introduced stability and scalability in networks by creating virtual communication channels
  - To create these channels, switches maintain a table that associates a host's MAC addresses to the port to which the host is connected.
  - Instead of flooding traffic out of every switch port, a switch uses the MAC address table to forward traffic only to the switch port associated with the destination MAC address.
  - The process of delivering traffic directly to the DMAC drastically reduces the size of the collision domain between the devices enabling hosts to transmit and receive data simultaneously (full-duplex).

### Configuration File Overview

#### Cisco Devices
- Cisco devices tend to have several different methods for an administrator to connect to them.
- The most common methods follow:
  - Direct connection to the console via the **console** or **Auxiliary (AUX) port**.
    - This is generally a **serial port** connection and often requires the included **Registered Jack (RJ)-45 to Recommended Standard (RS)-232 cable** to connect to.
    - The screen command or a terminal emulator can be used on Linux, while **PuTTY** or other terminal connection software is common on Windows.
  - Connection to a virtual console, typically via **Secure Shell (SSH) or Teletype Network (Telnet)**.
    - **Telnet** is generally discouraged because its traffic is transmitted in plaintext.
    - Binaries for SSH are available or commonly included on Linux systems and modern builds of Windows — though, **PuTTY** is still commonly used on Windows.
  - Many modern Cisco devices also include web interfaces for viewing the status of and managing the device.
    - These interfaces can be interacted with using standard browsers.

#### Cisco Security Model
- First connection to a Cisco Switch will show something similar to `hostname>`
- The **enable** command can be used to **raise privilege levels to 15**, and the **disable** command can be used to **lower the privilege levels to 1**.
- An **enable password** can be configured to **require a password** in order to raise the privilege level
- The basic security model for Cisco devices consists of three privilege levels:
- Zero (0)
  - Privilege level 0 is the **lowest level privilege** defined by default on Cisco devices.
  - When connected, the user only has access to these commands:
    - **disable**: Lower privilege level
    - **enable**: Raise privilege level
    - **exit**: Close the current session
    - **help**: Interact with the help system
    - **logout**: Close the current session
  - These commands only allow leaving the session or attempting to increase or decrease the privilege level.
- User (1)
  - At this level — in addition to the above commands — some additional utilities are available for troubleshooting connectivity, such as the **traceroute** and **ping** commands.
  - In addition, some configurations can be viewed via **show** commands.
  - No configuration changes can be made at this level.
- Privileged (15)
  - Privilege level 15 is the highest level defined by default on Cisco devices. At this privilege level, all commands are available, and the device can be configured.

#### Cisco Config Mode
- To make changes to the current configuration of the device, the **configure terminal** command must be used.
- For this command to be used, the current privilege level must be 15. As the configuration is navigated, the prompt changes to indicate what is currently being configured:

  ```
  Hostname#configure terminal
  Hostname(config)#interface GigabitEthernet0/0
  Hostname(config-if)#
  Hostname(config-if)#end
  Hostname#
  ```
  - In addition, you can completely leave via the **end** command
- Configuration sections are separated by exclamation points (!) for readability, which are for formatting and display purposes only.
- An example configuration file (trimmed) follows:

  ```
  version 15.2
  service timestamps debug datetime msec
  service timestamps log datetime msec
  no service password-encryption
  service compress-config
  !
  hostname Switch
  !
  !
  !
  no aaa new-model
  !
  !
  !
  ip cef
  login on-success log
  no ipv6 cef
  !
  !
  !
  spanning-tree mode pvst
  spanning-tree extend system-id
  !
  vlan internal allocation policy ascending
  !
  !
  !
  interface GigabitEthernet0/0
   media-type rj45
   negotiation auto
  !
  interface GigabitEthernet0/1
   media-type rj45
   negotiation auto
  !
  interface GigabitEthernet0/2
   media-type rj45
   negotiation auto
  !
  interface GigabitEthernet0/3
   media-type rj45
   negotiation auto
  !
  interface GigabitEthernet1/0
   media-type rj45
   negotiation auto
  !
  interface GigabitEthernet1/1
   media-type rj45
   negotiation auto
  ip forward-protocol nd
  !
  interface GigabitEthernet1/2
   media-type rj45
   negotiation auto
   shutdown
  ip forward-protocol nd
  !
  interface GigabitEthernet1/3
   media-type rj45
   negotiation auto
   shutdown
  ip forward-protocol nd
  !
  no ip http server
  no ip http secure-server
  !
  !
  !
  control-plane
  !
  !
  line con 0
  line aux 0
  line vty 0 4
  !
  !
  end
  ```
- Breakdown of the sections is as follows:
  ```
  version 15.2
  service timestamps debug datetime msec
  service timestamps log datetime msec
  no service password-encryption
  service compress-config
  ```
  - This section covers the version of the device, as well as some services that are configured:
    - **version**: Indicates the Cisco Internetwork Operating System (IOS) version for this device
    - **service timestamps**: Determines how timestamps for debug and log entries are displayed
    - **service password-encryption**: Automatically encrypts passwords when a new password is saved; no variant of the command means this is disabled
    - **service compress-config**: Configuration is compressed automatically by this service

  ```
  hostname Switch
  no aaa new-model
  ```
  - **hostname**: Sets the hostname for this device; shown in the command-line by default, may also be discovered by this name, or respond with this name during network discovery
  - **aaa new-model**: Authentication, Authorization, and Accounting (AAA); disabled, this device does not support AAA features, such as user accounts, user levels, or command-level logging as handled by the AAA feature

  ```
  ip cef
  no ipv6 cef
  ```
  - Enables Cisco Express Forwarding (CEF)

  - ```login on-success log```
    - Any successful login is logged to the console

  ```
  spanning-tree mode pvst
  spanning-tree extend system-id
  !
  vlan internal allocation policy ascending
  ```
  - These configurations are related to VLANs, which are covered later in this lesson:
    - **spanning-tree mode**: Determines the method used for Spanning Tree Protocol (STP)
    - **vlan internal allocation policy**: Specific VLANs reserved for internal use — determines where these VLANs begin enumerating (ascending starts at VLAN Identifier [ID] 1006 and up, descending at 4095 and below)

  ```
  interface GigabitEthernet1/3
  media-type rj45
  negotiation auto
  shutdown
  ```
  - Only one interface is covered here, as the others are nearly identical. 
    - **interface**: GigabitEthernet1/3 here indicates that this device is detected as a gigabit ethernet interface (as opposed to FastEthernet for 100 megabit ethernet) in slot zero, port zero; each internal slot may or may not contain multiple ports, depending on the interface card
    - **media-type**: RJ-45, Small Form-factor Pluggable (SFP), or Auto
    - **negotiation auto**: Attempts to automatically negotiate speed and duplex settings with the connected device.
    - **Shutdown**: Port is administratively disabled, ensuring that the port is not usable

  ```
  no ip http server
  no ip http secure-server
  ```
  - No web confg is enabled

- ```control-plane```
  - Control plane being enabled allows this device to have policies enabled that deal with Quality of Service (**QoS**), as well as mitigation of Denial of Service (**DoS**) and reconnaissance techniques

  ```
  line con 0
  line aux 0
  line vty 0 4
  ```
  - These configuration lines detail the settings used for connecting to the device:
    - **line con**: First — and typically only — serial console is enabled for this device; no configurations have been set beyond default settings
    - **line aux**: First — and typically only — AUX port is enabled for this device; no configurations have been set beyond default settings. Traditionally, the AUX port was often used for remote modem connections.
    - **line vty**: Five (0, 1, 2, 3, 4) virtual terminals (used for SSH or Telnet) are enabled. Unlike con and AUX ports, these are not physical.





